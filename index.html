<html>
  <head>
    <style>
      body {
        padding: 0;
        margin: 0;
      }
      .calculating{
        position:absolute;
        top:0;
        left:0;
        width:100%;
        height:100%;
        background:rgba(0,0,0,0.5)
      }
    </style>
  </head>
  <body>
    command scale: <input id="scale" type="number" value="100"><button>generate fullHD</button>
    <div style="width:100%">
      <button id="up" style="display:block;margin:20px auto">up</button>
      <div style="display:flex;justify-content:center">
        <div>
          <button id="left"><</button>
          <button id="bigger">+</button>
        </div>
        <canvas id="canvas" width="1920" height="1080"><div id="calcilating"></div></canvas>
        <div>
          <button id="smaller">-</button>
          <button id="right">></button>
        </div>
      </div>
      <button id="down" style="display:block;margin:20px auto">down</button>
    </div>
    <script>
      var width = 1920
      var height = 1080
      var shiftX = -960
      var shiftY = -540
      var enlarge = 600
      var defaultzx=0;                               // vynulovat komplexní proměnnou C
      var defaultzy=0;

      function generateWithParts () {
        let parts = []
        let workers = [
          new Worker('partWorker.js'),
          new Worker('partWorker.js'),
          new Worker('partWorker.js'),
          new Worker('partWorker.js'),
          new Worker('partWorker.js'),
          new Worker('partWorker.js'),
          new Worker('partWorker.js'),
          new Worker('partWorker.js')
        ]
        workers.forEach((worker, i) => {
          worker.postMessage(JSON.stringify({
            id: i,
            fractalInfo: {
              width: width,
              height: height,
              defaultzx: defaultzx,
              defaultzy: defaultzy
            },
            parts: workers.length,
            shiftX: shiftX,
             shiftY: shiftY,
             enlarge: enlarge
           }))
           worker.onmessage = (result) => {
             parts.push(result.data)
             if(parts.length === workers.length){
               drawParts(parts.sort((a, b) => a.id - b.id))
               workers.forEach(worker => worker.terminate())
             }

           }
        })
      }
      function drawParts(parts) {
        let bitmap = new Uint8ClampedArray(width*height*4)
        let bitmapIndex = 0
        parts.forEach(part => {
          part.result.forEach(bit => {
            bitmap[bitmapIndex] = bit
            bitmapIndex++
          })
        })
        const fractal = new ImageData(bitmap,width,height)
        context.putImageData(fractal, 0, 0)
      }


      const canvas = document.getElementById('canvas')
      var context = canvas.getContext('2d')
      document.getElementById('up').addEventListener('click', () => {
        shiftY -= parseInt(document.getElementById('scale').value)
        generateWithParts()
      })
      document.getElementById('down').addEventListener('click', () => {
        shiftY += parseInt(document.getElementById('scale').value)
        generateWithParts()
      })
      document.getElementById('left').addEventListener('click', () => {
        shiftX -= parseInt(document.getElementById('scale').value)
        generateWithParts()
      })
      document.getElementById('right').addEventListener('click', () => {
        shiftX += parseInt(document.getElementById('scale').value)
        generateWithParts()
      })
      document.getElementById('smaller').addEventListener('click', () => {
        enlarge -= parseInt(document.getElementById('scale').value)
        shiftX += parseInt(document.getElementById('scale').value)*0.50
        shiftY += parseInt(document.getElementById('scale').value)*0.50
        generateWithParts()
      })
      document.getElementById('bigger').addEventListener('click', () => {
        enlarge += parseInt(document.getElementById('scale').value)
        shiftX -= parseInt(document.getElementById('scale').value)*0.5
        shiftY -= parseInt(document.getElementById('scale').value)*0.5
        generateWithParts()
      })
      window.addEventListener('load', () => {
        generateWithParts()
      })
    </script>
  </body>
</html>
